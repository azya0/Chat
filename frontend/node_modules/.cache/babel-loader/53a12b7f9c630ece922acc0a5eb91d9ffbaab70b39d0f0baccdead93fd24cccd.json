{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/\\u0410\\u0437\\u044F/WebstormProjects/chat/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/\\u0410\\u0437\\u044F/WebstormProjects/chat/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/\\u0410\\u0437\\u044F/WebstormProjects/chat/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import{Navigate}from\"react-router-dom\";import axios from\"axios\";import{auth_headers,clearCurrentUser,currentUser}from\"../controllers/UserController\";import styles from'../css/index.module.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Chat(_ref){var data=_ref.data;function FormatDate(data){var date=new Date(Date.parse(data));var year=new Intl.DateTimeFormat('en',{year:'2-digit'}).format(date);var month=new Intl.DateTimeFormat('en',{month:'2-digit'}).format(date);var day=new Intl.DateTimeFormat('en',{day:'2-digit'}).format(date);return\"\".concat(day,\".\").concat(month,\".\").concat(year);}function FormatTime(data){var date=new Date(Date.parse(data));var hour=new Intl.DateTimeFormat('ru',{hour:'numeric'}).format(date);var minute=new Intl.DateTimeFormat('en',{minute:'2-digit'}).format(date);return\"\".concat(hour,\":\").concat(minute);}return/*#__PURE__*/_jsxs(\"div\",{className:styles.chat,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{children:data[\"interlocutor\"].username}),/*#__PURE__*/_jsx(\"p\",{children:FormatTime(data[\"last_message\"][\"created_at\"])})]}),/*#__PURE__*/_jsx(\"p\",{children:data[\"last_message\"].content})]});}function Main(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),chats=_useState2[0],setChats=_useState2[1];useEffect(function(){function getChats(){return _getChats.apply(this,arguments);}function _getChats(){_getChats=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get('http://localhost:443/chat/all',auth_headers());case 3:response=_context.sent;setChats(response.data.items);_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 10:case\"end\":return _context.stop();}},_callee,null,[[0,7]]);}));return _getChats.apply(this,arguments);}if(chats.length===0){getChats();}},[chats.length]);var user=currentUser();return user!==null?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:styles.header,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.welcome,children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Welcome, \",user.username,\"!\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:function onClick(){clearCurrentUser();window.location.href='/auth';},children:\"LogOut\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:styles.chatList,children:chats.map(function(data,index){return/*#__PURE__*/_jsx(Chat,{data:data},index);})})]}):/*#__PURE__*/_jsx(Navigate,{to:\"/auth\"});}export default Main;","map":{"version":3,"names":["React","useEffect","useState","Navigate","axios","auth_headers","clearCurrentUser","currentUser","styles","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Chat","_ref","data","FormatDate","date","Date","parse","year","Intl","DateTimeFormat","format","month","day","concat","FormatTime","hour","minute","className","chat","children","username","content","Main","_useState","_useState2","_slicedToArray","chats","setChats","getChats","_getChats","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","wrap","_callee$","_context","prev","next","get","sent","items","t0","console","log","stop","length","user","header","welcome","type","onClick","window","location","href","chatList","map","index","to"],"sources":["C:/Users/Азя/WebstormProjects/chat/src/components/Main.js"],"sourcesContent":["import React, {useEffect, useState} from 'react';\r\nimport {Navigate} from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nimport {auth_headers, clearCurrentUser, currentUser} from \"../controllers/UserController\";\r\nimport styles from '../css/index.module.css';\r\n\r\nfunction Chat({ data }) {\r\n    function FormatDate(data) {\r\n        const date = new Date(Date.parse(data));\r\n\r\n        let year = new Intl.DateTimeFormat('en', { year: '2-digit' }).format(date);\r\n        let month = new Intl.DateTimeFormat('en', { month: '2-digit' }).format(date);\r\n        let day = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(date);\r\n\r\n        return `${day}.${month}.${year}`;\r\n    }\r\n\r\n    function FormatTime(data) {\r\n        const date = new Date(Date.parse(data));\r\n\r\n        let hour = new Intl.DateTimeFormat('ru', {hour: 'numeric'}).format(date);\r\n        let minute = new Intl.DateTimeFormat('en', {minute: '2-digit'}).format(date);\r\n\r\n        return `${hour}:${minute}`;\r\n    }\r\n\r\n    return (\r\n        <div className={styles.chat}>\r\n            <div>\r\n                <h4>{data[\"interlocutor\"].username}</h4>\r\n                <p>{FormatTime(data[\"last_message\"][\"created_at\"])}</p>\r\n            </div>\r\n            <p>{data[\"last_message\"].content}</p>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction Main() {\r\n    const [chats, setChats] = useState([]);\r\n\r\n    useEffect(() => {\r\n        async function getChats() {\r\n            try {\r\n                const response = await axios.get('http://localhost:443/chat/all', auth_headers());\r\n\r\n                setChats(response.data.items);\r\n            }\r\n            catch (error) {\r\n                console.log(error);\r\n            }\r\n        }\r\n\r\n        if (chats.length === 0) {\r\n            getChats();\r\n        }\r\n    }, [chats.length]);\r\n\r\n    const user = currentUser();\r\n\r\n    return (user !== null) ? (\r\n        <>\r\n            <div className={styles.header}>\r\n                <div className={styles.welcome}>\r\n                    <h1>Welcome, {user.username}!</h1>\r\n                    <button type='button' onClick={() => {clearCurrentUser(); window.location.href = '/auth';}}>LogOut</button>\r\n                </div>\r\n                {/*<div className={styles.find}>*/}\r\n                {/*    <input/>*/}\r\n                {/*    <button type=\"button\">Find</button>*/}\r\n                {/*</div>*/}\r\n            </div>\r\n            <div className={styles.chatList}>\r\n                {chats.map((data, index) => <Chat key={index} data={data}/>)}\r\n            </div>\r\n        </>\r\n    ) : (<Navigate to=\"/auth\"/>);\r\n}\r\n\r\nexport default Main;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}