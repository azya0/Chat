{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/\\u0410\\u0437\\u044F/Desktop/chat/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _slicedToArray from\"C:/Users/\\u0410\\u0437\\u044F/Desktop/chat/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"C:/Users/\\u0410\\u0437\\u044F/Desktop/chat/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import Cookies from\"js-cookie\";import axios from\"axios\";import config from\"../config\";function auth_headers(){return Cookies.get('access_token')!==null?{headers:{Authorization:\"\".concat(Cookies.get('token_type'),\" \").concat(Cookies.get('access_token'))}}:{};}function setCurrentUser(_x,_x2){return _setCurrentUser.apply(this,arguments);}function _setCurrentUser(){_setCurrentUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(email,password){var GetToken,_GetToken,data,_i,_Object$entries,_Object$entries$_i,key,value,response;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_GetToken=function _GetToken3(){_GetToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(email,password){var params,_response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:params=new URLSearchParams({'username':email,'password':password});_context.prev=1;_context.next=4;return axios.post(\"\".concat(config.url,\"/auth/jwt/login\"),params);case 4:_response=_context.sent;return _context.abrupt(\"return\",_response.data);case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 11:case\"end\":return _context.stop();}},_callee,null,[[1,8]]);}));return _GetToken.apply(this,arguments);};GetToken=function _GetToken2(_x3,_x4){return _GetToken.apply(this,arguments);};_context2.prev=2;_context2.next=5;return GetToken(email,password);case 5:data=_context2.sent;for(_i=0,_Object$entries=Object.entries(data);_i<_Object$entries.length;_i++){_Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];Cookies.set(key,value);}_context2.next=9;return axios.get(\"\".concat(config.url,\"/users/me\"),auth_headers());case 9:response=_context2.sent;localStorage.setItem('current_user',JSON.stringify(response.data));return _context2.abrupt(\"return\",0);case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](2);console.log(_context2.t0);case 17:return _context2.abrupt(\"return\",-1);case 18:case\"end\":return _context2.stop();}},_callee2,null,[[2,14]]);}));return _setCurrentUser.apply(this,arguments);}function currentUser(){if(Cookies.get('access_token')==null){localStorage.setItem('current_user',null);return{};}var data=localStorage.getItem('current_user');if(data!==null)return JSON.parse(data);return{};}function clearCurrentUser(){localStorage.setItem('current_user',null);Cookies.remove('access_token');Cookies.remove('token_type');}function currentUserExist(){return!(Object.getOwnPropertyNames(currentUser()).length===0);}export{auth_headers,setCurrentUser,currentUser,currentUserExist,clearCurrentUser};","map":{"version":3,"names":["Cookies","axios","config","auth_headers","get","headers","Authorization","concat","setCurrentUser","_x","_x2","_setCurrentUser","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","email","password","GetToken","_GetToken","data","_i","_Object$entries","_Object$entries$_i","key","value","response","wrap","_callee2$","_context2","prev","next","_GetToken3","_callee","params","_response","_callee$","_context","URLSearchParams","post","url","sent","abrupt","t0","console","log","stop","_GetToken2","_x3","_x4","Object","entries","length","_slicedToArray","set","localStorage","setItem","JSON","stringify","currentUser","getItem","parse","clearCurrentUser","remove","currentUserExist","getOwnPropertyNames"],"sources":["C:/Users/Азя/Desktop/chat/frontend/src/controllers/userController.js"],"sourcesContent":["import Cookies from \"js-cookie\";\r\nimport axios from \"axios\";\r\nimport config from \"../config\";\r\n\r\nfunction auth_headers() {\r\n    return (Cookies.get('access_token') !== null) ? {\r\n        headers: {Authorization: `${Cookies.get('token_type')} ${Cookies.get('access_token')}`},\r\n    } : {};\r\n}\r\n\r\nasync function setCurrentUser(email, password) {\r\n    async function GetToken(email, password) {\r\n        const params = new URLSearchParams({ 'username': email, 'password': password });\r\n\r\n        try {\r\n            let response = await axios.post(`${config.url}/auth/jwt/login`, params);\r\n            return response.data;\r\n        }\r\n        catch (error) {\r\n            console.log(error);\r\n        }\r\n    }\r\n\r\n    try {\r\n        const data = await GetToken(email, password);\r\n\r\n        for (const [key, value] of Object.entries(data)) {\r\n            Cookies.set(key, value);\r\n        }\r\n\r\n        const response = await axios.get(`${config.url}/users/me`, auth_headers());\r\n\r\n        localStorage.setItem('current_user', JSON.stringify(response.data));\r\n\r\n        return 0;\r\n    }\r\n    catch (error) {\r\n        console.log(error);\r\n    }\r\n\r\n    return -1;\r\n}\r\n\r\nfunction currentUser() {\r\n    if (Cookies.get('access_token') == null) {\r\n        localStorage.setItem('current_user', null);\r\n        return {};\r\n    }\r\n\r\n    const data = localStorage.getItem('current_user');\r\n\r\n    if (data !== null)\r\n        return JSON.parse(data);\r\n\r\n    return {};\r\n}\r\n\r\nfunction clearCurrentUser() {\r\n    localStorage.setItem('current_user', null);\r\n\r\n    Cookies.remove('access_token');\r\n    Cookies.remove('token_type');\r\n}\r\n\r\n\r\nfunction currentUserExist() {\r\n    return !(Object.getOwnPropertyNames(currentUser()).length === 0);\r\n}\r\n\r\nexport {auth_headers, setCurrentUser, currentUser, currentUserExist, clearCurrentUser};\r\n"],"mappings":"qaAAA,MAAO,CAAAA,OAAO,KAAM,WAAW,CAC/B,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,CAAAC,MAAM,KAAM,WAAW,CAE9B,QAAS,CAAAC,YAAYA,CAAA,CAAG,CACpB,MAAQ,CAAAH,OAAO,CAACI,GAAG,CAAC,cAAc,CAAC,GAAK,IAAI,CAAI,CAC5CC,OAAO,CAAE,CAACC,aAAa,IAAAC,MAAA,CAAKP,OAAO,CAACI,GAAG,CAAC,YAAY,CAAC,MAAAG,MAAA,CAAIP,OAAO,CAACI,GAAG,CAAC,cAAc,CAAC,CAAE,CAC1F,CAAC,CAAG,CAAC,CAAC,CACV,CAAC,QAEc,CAAAI,cAAcA,CAAAC,EAAA,CAAAC,GAAA,SAAAC,eAAA,CAAAC,KAAA,MAAAC,SAAA,YAAAF,gBAAA,EAAAA,eAAA,CAAAG,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAA7B,SAAAC,SAA8BC,KAAK,CAAEC,QAAQ,KAC1B,CAAAC,QAAQ,CAAAC,SAAA,CAAAC,IAAA,CAAAC,EAAA,CAAAC,eAAA,CAAAC,kBAAA,CAAAC,GAAA,CAAAC,KAAA,CAAAC,QAAA,QAAAb,mBAAA,GAAAc,IAAA,UAAAC,UAAAC,SAAA,iBAAAA,SAAA,CAAAC,IAAA,CAAAD,SAAA,CAAAE,IAAA,SAAAZ,SAAA,UAAAa,WAAA,EAAAb,SAAA,CAAAP,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAvB,SAAAmB,QAAwBjB,KAAK,CAAEC,QAAQ,MAAAiB,MAAA,CAAAC,SAAA,QAAAtB,mBAAA,GAAAc,IAAA,UAAAS,SAAAC,QAAA,iBAAAA,QAAA,CAAAP,IAAA,CAAAO,QAAA,CAAAN,IAAA,SAC7BG,MAAM,CAAG,GAAI,CAAAI,eAAe,CAAC,CAAE,UAAU,CAAEtB,KAAK,CAAE,UAAU,CAAEC,QAAS,CAAC,CAAC,CAAAoB,QAAA,CAAAP,IAAA,GAAAO,QAAA,CAAAN,IAAA,SAGtD,CAAAhC,KAAK,CAACwC,IAAI,IAAAlC,MAAA,CAAIL,MAAM,CAACwC,GAAG,oBAAmBN,MAAM,CAAC,QAAnER,SAAQ,CAAAW,QAAA,CAAAI,IAAA,QAAAJ,QAAA,CAAAK,MAAA,UACLhB,SAAQ,CAACN,IAAI,SAAAiB,QAAA,CAAAP,IAAA,GAAAO,QAAA,CAAAM,EAAA,CAAAN,QAAA,aAGpBO,OAAO,CAACC,GAAG,CAAAR,QAAA,CAAAM,EAAM,CAAC,CAAC,yBAAAN,QAAA,CAAAS,IAAA,MAAAb,OAAA,gBAE1B,UAAAd,SAAA,CAAAT,KAAA,MAAAC,SAAA,IAVcO,QAAQ,UAAA6B,WAAAC,GAAA,CAAAC,GAAA,SAAA9B,SAAA,CAAAT,KAAA,MAAAC,SAAA,IAAAkB,SAAA,CAAAC,IAAA,GAAAD,SAAA,CAAAE,IAAA,SAaA,CAAAb,QAAQ,CAACF,KAAK,CAAEC,QAAQ,CAAC,QAAtCG,IAAI,CAAAS,SAAA,CAAAY,IAAA,CAEV,IAAApB,EAAA,GAAAC,eAAA,CAA2B4B,MAAM,CAACC,OAAO,CAAC/B,IAAI,CAAC,CAAAC,EAAA,CAAAC,eAAA,CAAA8B,MAAA,CAAA/B,EAAA,GAAE,CAAAE,kBAAA,CAAA8B,cAAA,CAAA/B,eAAA,CAAAD,EAAA,KAArCG,GAAG,CAAAD,kBAAA,IAAEE,KAAK,CAAAF,kBAAA,IAClBzB,OAAO,CAACwD,GAAG,CAAC9B,GAAG,CAAEC,KAAK,CAAC,CAC3B,CAACI,SAAA,CAAAE,IAAA,SAEsB,CAAAhC,KAAK,CAACG,GAAG,IAAAG,MAAA,CAAIL,MAAM,CAACwC,GAAG,cAAavC,YAAY,CAAC,CAAC,CAAC,QAApEyB,QAAQ,CAAAG,SAAA,CAAAY,IAAA,CAEdc,YAAY,CAACC,OAAO,CAAC,cAAc,CAAEC,IAAI,CAACC,SAAS,CAAChC,QAAQ,CAACN,IAAI,CAAC,CAAC,CAAC,OAAAS,SAAA,CAAAa,MAAA,UAE7D,CAAC,UAAAb,SAAA,CAAAC,IAAA,IAAAD,SAAA,CAAAc,EAAA,CAAAd,SAAA,aAGRe,OAAO,CAACC,GAAG,CAAAhB,SAAA,CAAAc,EAAM,CAAC,CAAC,eAAAd,SAAA,CAAAa,MAAA,UAGhB,CAAC,CAAC,2BAAAb,SAAA,CAAAiB,IAAA,MAAA/B,QAAA,iBACZ,UAAAN,eAAA,CAAAC,KAAA,MAAAC,SAAA,GAED,QAAS,CAAAgD,WAAWA,CAAA,CAAG,CACnB,GAAI7D,OAAO,CAACI,GAAG,CAAC,cAAc,CAAC,EAAI,IAAI,CAAE,CACrCqD,YAAY,CAACC,OAAO,CAAC,cAAc,CAAE,IAAI,CAAC,CAC1C,MAAO,CAAC,CAAC,CACb,CAEA,GAAM,CAAApC,IAAI,CAAGmC,YAAY,CAACK,OAAO,CAAC,cAAc,CAAC,CAEjD,GAAIxC,IAAI,GAAK,IAAI,CACb,MAAO,CAAAqC,IAAI,CAACI,KAAK,CAACzC,IAAI,CAAC,CAE3B,MAAO,CAAC,CAAC,CACb,CAEA,QAAS,CAAA0C,gBAAgBA,CAAA,CAAG,CACxBP,YAAY,CAACC,OAAO,CAAC,cAAc,CAAE,IAAI,CAAC,CAE1C1D,OAAO,CAACiE,MAAM,CAAC,cAAc,CAAC,CAC9BjE,OAAO,CAACiE,MAAM,CAAC,YAAY,CAAC,CAChC,CAGA,QAAS,CAAAC,gBAAgBA,CAAA,CAAG,CACxB,MAAO,EAAEd,MAAM,CAACe,mBAAmB,CAACN,WAAW,CAAC,CAAC,CAAC,CAACP,MAAM,GAAK,CAAC,CAAC,CACpE,CAEA,OAAQnD,YAAY,CAAEK,cAAc,CAAEqD,WAAW,CAAEK,gBAAgB,CAAEF,gBAAgB"},"metadata":{},"sourceType":"module","externalDependencies":[]}